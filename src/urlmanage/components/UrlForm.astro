---
import { actions } from 'astro:actions'
---

<section class="animate-pop rounded-[12px] bg-white/5 border border-whitte/10 backdrop-blur-none p-8 shadow-xl/20">
    <div class="flex items-center gap-3 mb-6">
        <div class="flex gap-2">
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
        </div>
        <span class="text-sm text-slate-400">Inserta tu URL aqu√≠</span>
    </div>
    <form 
        method="POST" 
        id="shorten-form" 
        class="mt-6 gap-3 items-center" 
        action={actions.setShortUrl}
    >
        <div class="flex flex-col sm:flex-row">
            <input
            type="url"
            name="url"
            id="url"
            required
            placeholder="https://tu-enlace-muy-largo.com/con/muchos/parametros"
            class="mr-4 bg-[#1E293B] mb-3 sm:mb-0 rounded-xl px-4 py-3 w-full text-slate-300 outline-none"
            />
            <button type="submit"
            class="w-full sm:w-auto px-8 rounded-lg bg-gradient-to-r hover:scale-105 from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 transition-all shadow-lg shadow-purple-500/25">
            Acortar URL
            </button>
        </div>

        <div id="message" class="hidden mt-4 flex items-center justify-between bg-[#1E293B] rounded-xl border-2 p-3 border-purple-500/30">
            <span class="text-purple-300"><i class="p-2 ti ti-unlink"></i>Tu URL acortada es:</span>
            <div class="flex gap-2 items-center">
                <i class="w-7 text-[20px] text-blue-300 ti ti-copy"></i>
                <i class="w-6 text-[20px] text-purple-400 ti ti-external-link"></i>
        </div>
    </div>
    </form>
</section>

<script>

    import { actions , isInputError} from 'astro:actions'

    // Elementos del DOM
    const shortenForm = document.getElementById('shorten-form') as HTMLFormElement
    const message = document.getElementById('message') as HTMLDivElement

    if (shortenForm){
        shortenForm.addEventListener('submit', async (e) => {
            console.log("Formulario enviado");
            e.preventDefault()
            const formData = new FormData(shortenForm)
            const url = formData.get('url') as string

            const { data, error } = await actions.setShortUrl({ url })

            if (error) {
                console.error("Error:", error)
            }
            if (data) {
                console.log(data);
            }
        })
    }
    
    // async function setShortUrl(url: string) {
    //     try{
    //         const { data, error } = await actions.setShortUrl({ url })

    //         if (error){
    //             console.error("Error:", error)
    //             return
    //         }

    //         if (data){
    //             console.log(data)
    //         }
    //     } catch(error) {
    //         console.error("Error:", error)
    //     }
    // }
    
</script>